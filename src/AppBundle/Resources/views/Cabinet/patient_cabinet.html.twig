{% extends "FOSUserBundle::layout.html.twig" %}
            {% block menu %}
                {{ include('AppBundle::menu.html.twig') }}
            {% endblock %}

{% block body %}

<div class="row">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s3"><a href="#chart">График</a></li>
        <li class="tab col s3"><a class="active" href="#mtable">Таблица</a></li>
      </ul>
    </div>
    <div id="chart" class="col s12">
		<div id="container" class="container well" data-highcharts-chart="0"></div>
	</div>
    <div id="mtable" class="col s12">
		<table class="bordered striped">
			<thead>
			<tr>
				<th>Дата</th>
				<th>Вес</th>
			</tr>
			</thead>
			<tbody>
			{% for meas in measuring %}
				<tr>
					<td>{{ meas.date|date("d.m.Y H:i") }}</td>
					<td>{{ meas.value }}</td>
					<td>
                        <a class="modal-trigger waves-effect waves-teal btn-flat"
                           data-id="{{ meas.id }}"
                           href="#stability_range_modal">
                            Стабильность ряда
                        </a>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
  </div>
 
    <div id="stability_range_modal" class="modal">
		<div class="modal-content">
			<h4>Стабильность ряда: <span class="badge" id="stability_range"> </span></h4>
		</div>
    </div>

{% endblock %}

{% block javascripts  %}
    {{ parent() }}
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script>
    $(document).ready(function() {

    $("a[data-id]").on("click", function(){
        $('#stability_range_modal').modal();
        var id = $(this).data('id');
        $.post(Routing.generate('get_stability_range'),{data: id}, function(data) {
            console.log(data);
            $('#stability_range').text(data.stabilityRange.stability_range);
        });
    });

    function getStabilityRange(id) {

    }

    Highcharts.setOptions(
        {lang: {
            contextButtonTitle: "Меню",
            decimalPoint: ".",
            downloadJPEG: "Сохранить как JPEG",
            downloadPDF: "Сохранить как PDF",
            downloadPNG: "Сохранить как PNG",
            downloadSVG: "Сохранить как  SVG",
            drillUpText: "Назад к {series.name}",
            invalidDate:"",
            loading: "Загрузка",
            months: [ "Январь" , "Февраль" , "Март" , "Апрель" , "Май" , "Июнь" , "Июль" , "Август" , "Сетябрь" , "Октябрь" , "Ноябрь" , "Декабрь"],
            noData: "Нет данных для отображения",
            numericSymbolMagnitude: 1000,
            numericSymbols: [ "k" , "M" , "G" , "T" , "P" , "E"],
            printChart: "Печать диаграммы",
            resetZoom: "Сбросить увеличение",
            resetZoomTitle: "Сбросить увеличение1:1",
            shortMonths: [ "Янв" , "Фев" , "Мрт" , "Апр" , "Май " , "Июн " , "Июл " , "Авг" , "Сен" , "Окт" , "Нбр" , "Дек"],
            shortWeekdays: undefined,
            thousandsSep: " ",
            weekdays: ["Воскресенье", "Понедельник", "Вторник", "Среда", "Чеверг", "Пятница", "Суббота"]
        }}
    );
    var url = Routing.generate('cabinet');
        $.post(url, function(data) {
            var measuring = data.measuring;
            Highcharts.chart('container', {
                chart: {
                    zoomType: 'x'
                },
                title: {
                    text: 'Вес'
                },

                subtitle: {
                    text: 'Кликните и виделите область диаграммы, чтобы увеличить маштаб'
                },

                xAxis: {
                    type: 'datetime',
                    title: {
                        text: 'Значение'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Дата'
                    },
                },
                legend: {
                    /*layout: 'vertical',
                    align: 'right',
                    verticalAlign: 'middle',*/
                    enabled: false
                },
                plotOptions: {
                    area: {
                        fillColor: {
                            linearGradient: {
                                x1: 0,
                                y1: 0,
                                x2: 0,
                                y2: 1
                            },
                            stops: [
                                [0, Highcharts.getOptions().colors[0]],
                                [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                            ]
                        },
                        marker: {
                            radius: 2
                        },
                        lineWidth: 1,
                        states: {
                            hover: {
                                lineWidth: 1
                            }
                        },
                        threshold: null
                    }
                },
                series: [{
                    type: 'area',
                    name: 'Динамика значений веса',
                    data: measuring
                }]
            });
        });
    });
</script>

{% endblock %}